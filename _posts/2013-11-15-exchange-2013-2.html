---
layout: post
title: Восстановление информации в общих папках Exchange 2013 - часть 2
date: '2013-11-15T12:24:00.000+04:00'
author: Михаил Даньшин
tags:
- Exchange 2013
- PowerShell
- Outlook
- Exсhange
- Статьи и инструкции
modified_time: '2013-11-18T12:00:51.585+04:00'
thumbnail: http://lh3.ggpht.com/-iQdUe11ZWyw/UoS5vkp0XHI/AAAAAAAABlY/pwL42RhNarI/s72-c/clip_image004%25255B4%25255D%25255B3%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-4356865488511124854.post-64407381698863234
blogger_orig_url: https://www.danshin.ms/2013/11/exchange-2013-2.html
---

<div style="text-align: right;"><i>Для удобства я разбил статью на две части.&nbsp;</i></div><div style="text-align: right;"><i>В первую часть вошло описание восстановления&nbsp;</i></div><div style="text-align: right;"><i>посредствам Outlook,&nbsp;</i><i>а во вторую&nbsp;</i><i>с&nbsp;</i><i>использованием&nbsp;</i></div><div style="text-align: right;"><i>Exchange Management Shell.</i></div><div style="text-align: right;"><br /></div><div style="text-align: right;"><a href="http://www.danshin.ms/2013/11/exchange-2013-1.html">Восстановление информации в общих папках Exchange 2013 - часть 1</a></div><div style="text-align: right;"><a href="http://www.danshin.ms/2013/11/exchange-2013-2.html">Восстановление информации в общих папках Exchange 2013 - часть 2</a></div><div style="text-align: right;"><br /></div><b>Использование </b><b>Exchange</b><b> </b><b>Management</b><b> </b><b>Shell</b><b> для восстановления удаленных общих папок</b> <br /><b><br /></b>Хотя восстановление общих папок с помощью Outlook является одним из вариантов восстановления, у нас еще есть <b>Exchange</b><b> </b><b>Management</b><b> </b><b>Shell</b>, который может использоваться нами в сценарии восстановления и может облегчить работу. Допустим, вам нужно восстановить общую папку в корневом каталоге или вы не являетесь владельцем общей папки, которая была удалена, и вы должны ее восстановить. <br />Для этого Вы запускаете следующую команду: <br /><br /><span style="background-color: #cccccc; color: #333333; font-family: Consolas, 'Courier New', Courier, monospace; font-size: 12px;">Get-PublicFolder –Identity “\NON_IPM_SUBTREE” –Recurse | FL &gt;C:\pf2.txt</span><br /><br />После выполнения команды будет создан текстовый файл. Вам нужно открыть его и найти путь к нужной Вам папке. <br /><br />Скажем, у меня есть папка с именем "Test-3", которая была удалена. И я нахожу нужную папку в текстовом файле: <br /><br /><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/2235.image_5F00_5FD7FCE6.png"><img alt="clip_image004[4]" border="0" height="218" src="http://lh3.ggpht.com/-iQdUe11ZWyw/UoS5vkp0XHI/AAAAAAAABlY/pwL42RhNarI/clip_image004%25255B4%25255D%25255B3%25255D.png?imgmax=800" style="border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline;" title="clip_image004[4]" width="628" /></a> <br /><br />Теперь откройте консоль Exchange (Exchange Management Shell) и выполните следующую команду, чтобы восстановить папку: <br /><br /><span style="background-color: #cccccc; color: #333333; font-family: Consolas, 'Courier New', Courier, monospace; font-size: 12px;">Set-PublicFolder –Identity “\NON_IPM_SUBTREE\DUMPSTER_ROOT\<guid>\Test-3” –Path “\” –Verbose</guid></span><br /><br /><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/7870.image_5F00_1AC1C061.png"><img alt="clip_image005[4]" border="0" height="158" src="http://lh6.ggpht.com/-V-Gz9fQvnbk/UoS5weckBsI/AAAAAAAABlg/4wrq3a999og/clip_image005%25255B4%25255D%25255B3%25255D.png?imgmax=800" style="border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline;" title="clip_image005[4]" width="690" /></a> <br /><br />Вот и все! Теперь вы можете открыть Outlook, и обратиться к общей папке, которую вы только что восстановили. Содержание и права доступа будут восстановлены. <br />Вы можете использовать этот метод для восстановления любой удаленной папки, в том числе и дочерней. Просто восстановите корневую папку и все ее содержимое (включая дочерние папки) будет восстановлено вместе с ней. <br /><br /><b>Обратите внимание</b>: нет необходимости восстанавливать дочерние папки в ее родительское местоположение. Она также может быть восстановлена в корневую иерархию общих папок. Просто укажите желаемый путь. <br /><br /><b>Как восстановить общую папку, период хранения которой истек?</b> <br /><b><br /></b>Восстановление публичной папки во время периода хранения не представляет сложностей. Но восстановление общих папок, которые были удалены из корзины является более сложным процессом. Вам необходимо восстановить последнюю полную резервную копию базы, где находится нужная папка. <br />Как только вы восстановите базу данных в «<b>Базу Данных Восстановления</b>» (<b>Recovery</b> <b>Database</b><b>)</b>. Вам нужно запустить командную оболочку (Shell command) для восстановления содержимого в пострадавшей общей папке. <br />Вот требования (pre-requisites) для данного метода: <br /><ul><li>Для восстановления данных в общую папку она должна существовать. Другими словами, данные, которые вы пытаетесь восстановить не будет создавать структуру папок автоматически (в текущей версии) </li><li>Убедитесь, что у Вас установлено Накопительное Обновление 2 (Cumulative Update 2) для Microsoft Exchange 2013 Server, чтобы избежать проблем с разрешениями, которые обсуждаются в этом блоге (<a href="http://blogs.technet.com/b/exchange/archive/2013/07/12/e2013-rtm-cu2-issue-public-folder-permissions-loss-after-pf-mailbox-move.aspx">Exchange 2013 RTM CU2 (712.22) Issue - Public Folder Permissions Loss after PF Mailbox Move</a>).</li></ul>Давайте рассмотрим конкретный сценарий, чтобы лучше во всем разобраться. <br />У вас есть папка с именем «<b>Июньские Отчеты</b>», срок действия которой истек и не может быть восстановлен из удаленных элементов, и, следовательно, должен быть восстановлен из резервной копии <br /><br />Для того, чтобы восстановить папку «<b>Июньские Отчеты</b>» из восстановленной базы данных, мы должны иметь папку с названием «<b>Июньские Отчеты</b>» целевом почтовом ящике, куда мы хотим провести восстановление. Это ограничение процесса восстановления в это время. Это ограничение текущей версии. <br /><br />&nbsp; <br /><a href="http://lh4.ggpht.com/-5gtHyQ5XA_s/UoS5w5eQXGI/AAAAAAAABlo/2CVGDQYPOTE/s1600-h/image%25255B9%25255D.png"><img alt="image" border="0" height="283" src="http://lh5.ggpht.com/-bVuCIYxhNi8/UoS5xcvHHrI/AAAAAAAABlw/m33LsWRsWnI/image_thumb%25255B5%25255D.png?imgmax=800" style="border: 0px; display: inline;" title="image" width="640" /></a>  <br /><br />Давайте выполним все шаг за шагом: <br /><br />Нам нужно восстановить корневую папку «<b>Июньские отчеты</b>». Имеется хорошая последняя полная резервная копия с необходимыми данными. Восстановите базу данных в базу данных восстановления (Recovery Database). Как только база данных восстановится выполните следующие действия: <br /><br />Создайте новую папку с именем «<b>Июньские отчеты</b>» в почтовом ящике, если ее не существует. Если она существует, то вы можете пропустить этот шаг. <br /><br /><span style="background-color: #cccccc; color: #333333; font-family: Consolas, 'Courier New', Courier, monospace; font-size: 12px;">New-PublicFolder –Mailbox “Content Mailbox name” –name “Июньские отчеты”</span><br /><span style="background-color: #cccccc; color: #333333; font-family: Consolas, 'Courier New', Courier, monospace; font-size: 12px;"><br /></span><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/3583.image_5F00_40505F24.png"><img alt="clip_image008[4]" border="0" height="95" src="http://lh4.ggpht.com/-TRMrHMIy7bg/UoS5x4LAm-I/AAAAAAAABl4/5mZf0W2ALiA/clip_image008%25255B4%25255D%25255B3%25255D.png?imgmax=800" style="border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline;" title="clip_image008[4]" width="628" /></a><br /><br />Затем выполните следующую команду: <br /><br /><span style="background-color: #cccccc; color: #333333; font-family: Consolas, 'Courier New', Courier, monospace; font-size: 12px;">New-MailboxRestoreRequest –SourceDatabase “имя Базы Данных Восстановления (<b>recovery database</b>)” –SourceStoreMailbox “имя п/я в котором содержится пострадавшая папка” –TargetMailbox “п/я в который переносим папку” –AllowLegacyDNMismatch –IncludeFolders “имя пострадвашей папки”</span><br /><br /><br /><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/7356.image_5F00_1D8F2767.png"><img alt="clip_image009[4]" border="0" height="67" src="http://lh3.ggpht.com/-kH3MLs2o5oY/UoS5ypWIJ1I/AAAAAAAABmA/e9wxJfaVOD4/clip_image009%25255B4%25255D%25255B3%25255D.png?imgmax=800" style="border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline;" title="clip_image009[4]" width="628" /></a> <br /><br />После завершения, вы можете запустить следующую команду, чтобы проверить, успешность восстановления данных: <br /><br /><span style="background-color: #cccccc; color: #333333; font-family: Consolas, 'Courier New', Courier, monospace; font-size: 12px;">Get-MailboxrestoreRequest | Where { $_.Status –eq “Completed” }</span><br /><br /><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/6622.image_5F00_73AEB331.png"><img alt="clip_image010[4]" border="0" height="75" src="http://lh5.ggpht.com/-hgrUiQFOdO4/UoS5zEZwU-I/AAAAAAAABmI/T-4ljn2vzPI/clip_image010%25255B4%25255D%25255B3%25255D.png?imgmax=800" style="border: 0px; display: inline;" title="clip_image010[4]" width="627" /></a> <br /><br />Для подтверждения завершения восстановления, выполните команду&nbsp;<span style="background-color: #ffffcc; color: #333333; font-family: Consolas, 'Courier New', Courier, monospace; font-size: 12px;">Get-MailboxRestoreRequestStatistics</span>&nbsp;и проверьте значение&nbsp;<b>ItemsTransferred</b> <br /><b><br /></b><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/8713.image_5F00_757F08F8.png"><img alt="clip_image011[4]" border="0" height="132" src="http://lh5.ggpht.com/-AErdF-lZDSg/UoS5zj_C-BI/AAAAAAAABmQ/HIE4bmUt-Wc/clip_image011%25255B4%25255D%25255B9%25255D.png?imgmax=800" style="border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline;" title="clip_image011[4]" width="621" /></a> <br /><br />Теперь Вы можете увидеть восстановленные данные в Outlook: <br /><br /><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/8662.image_5F00_72D8DDF8.png"><img alt="clip_image012[4]" border="0" height="226" src="http://lh4.ggpht.com/-NTs_8e_yOW8/UoS50ebuOnI/AAAAAAAABmY/vNtd3zF-ysM/clip_image012%25255B4%25255D%25255B3%25255D.png?imgmax=800" style="border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline;" title="clip_image012[4]" width="570" /></a> <br /><br />Восстановленные элементы буду присутствовать наряду с новыми элементами в папке. <br />Для более подробной информации пройдите по следующим ссылкам (на англ. языке): <br /><ul><li><a href="http://technet.microsoft.com/en-us/library/ff829875(v=exchg.150).aspx">New-MailboxRestoreRequest</a> </li><li><a href="http://technet.microsoft.com/en-us/library/ff829912(v=exchg.150).aspx">Get-MailboxRestoreRequestStatistics</a></li></ul><b>Заключение</b> <br />В приведенной выше статье я попытался пролить свет на то, как восстановить содержимое из общих папок, когда они будут удалены, а также описал сценарии, где мы должны восстановить всю общую папку. Я планирую продолжить описание других сценариев в последующих статьях. <br /><br />Автор статьи: Siddhesh Dalvi. <br /><br />Оригинал статьи на англ. языке находится по следующей ссылке: - <a href="http://blogs.technet.com/b/exchange/archive/2013/08/23/recovering-public-folder-information-in-exchange-2013.aspx">http://blogs.technet.com/b/exchange/archive/2013/08/23/recovering-public-folder-information-in-exchange-2013.aspx</a> <br /><br />Переводчик:<br />Даньшин Михаил Сергеевич <br />Блог – <a href="http://danshin.ms/">http://danshin.ms</a><br />Facebook - <a href="https://www.facebook.com/Danshin.ms">https://www.facebook.com/Danshin.ms</a><br />E-Mail: - <a href="mailto:mdanshin@gmail.com">mdanshin@gmail.com</a><br><iframe src="//www.facebook.com/plugins/follow?href=https%3A%2F%2Fwww.facebook.com%2Fmdanshin&amp;layout=standard&amp;show_faces=true&amp;colorscheme=light&amp;width=450&amp;height=80" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:450px; height:80px;" allowTransparency="true"></iframe>