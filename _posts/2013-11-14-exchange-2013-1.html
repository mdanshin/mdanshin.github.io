---
layout: post
title: Восстановление информации в общих папках Exchange 2013 - часть 1
date: '2013-11-14T17:05:00.000+04:00'
author: Михаил Даньшин
tags:
- Exchange 2013
- Microsoft
- PowerShell
- Outlook
- Exсhange
- Статьи и инструкции
modified_time: '2013-11-18T11:30:26.123+04:00'
thumbnail: http://lh3.ggpht.com/-Zvo77P4I9gc/UoS5sSM9iVI/AAAAAAAABlA/WG5iw6yTXdI/s72-c/clip_image001%25255B4%25255D%25255B3%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-4356865488511124854.post-1794440195999986299
blogger_orig_url: https://www.danshin.ms/2013/11/exchange-2013-1.html
---

<div style="text-align: right;"><i>Для удобства я разбил статью на две части.&nbsp;</i></div><div style="text-align: right;"><i>В первую часть вошло описание восстановления&nbsp;</i></div><div style="text-align: right;"><i>посредствам Outlook,&nbsp;</i><i>а во вторую&nbsp;</i><i>с&nbsp;</i><i>использованием&nbsp;</i></div><div style="text-align: right;"><i>Exchange Management Shell.</i></div><br /><div style="text-align: right;"><br /><div><a href="http://www.danshin.ms/2013/11/exchange-2013-1.html">Восстановление информации в общих папках Exchange 2013 - часть 1</a></div><div><a href="http://www.danshin.ms/2013/11/exchange-2013-2.html">Восстановление информации в общих папках Exchange 2013 - часть 2</a></div></div><br />В Microsoft Exchange 2013, Общие Папки (Public Folders) были переработаны и стали использовать инфраструктуру почтовых ящиков. Это позволяет получить все преимущества высокой доступности и технологий хранения. Общие папки используют специально-спроектированные почтовые ящики, чтобы хранить иерархию и контент. Это так же означает, что больше нет базы данных общих папок. <br /><br />Высокая Доступность (High Availability) общих папок обеспечивается за счет групп обеспечения доступности баз данных (database availability group (DAG)). Чтобы получить больше информации об архитектуре общих папок посетите следующую страницу: <u>Public folders in the new Office</u>. (на англ. языке) <br /><br />Многие уже начали использовать новые преимущества. Но так как общие папки претерпели изменения, то нужно позаботится и об изменении плана восстановления удаленных данных. <br />В этом очерке Вы найдете различные сценарии восстановления, которые могут быть применены к общим папкам в Microsoft Exchange 2013. <br /><br /><b>Восстановление элементов удаленных из общих папок</b><b></b> <br /><ul><li>Мы будем следовать тому же методу, который использовали ранее для восстановления удаленных элементов из корзины (dumpster) "обычных" почтовых ящиков </li><li>Восстановление удаленных элементов для общих папок по умолчанию включено начиная с Outlook 2007, который является минимально необходимой версией для Exchange 2013. </li><li>Удаленное содержимое автоматически помещается в корзину (Dumpster), где и остается в соответствии с действующими политиками хранения.</li></ul>Чтобы понять это, давайте рассмотрим пример: <br />Если пользователь удаляет элемент из определенной папки, то он получит вот такое сообщение: <br /><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/0486.image_5F00_3AB59118.png"><img alt="clip_image001[4]" border="0" height="241" src="http://lh3.ggpht.com/-Zvo77P4I9gc/UoS5sSM9iVI/AAAAAAAABlA/WG5iw6yTXdI/clip_image001%25255B4%25255D%25255B3%25255D.png?imgmax=800" style="border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline;" title="clip_image001[4]" width="412" /></a> <br /><br />Чтобы восстановить данные, пользователю необходимо зайти в меню Outlook «<b>Восстановить</b><b> </b><b>удаленные</b><b> </b><b>элементы</b>» (<b>Recover Deleted Items option)</b>. В открывшемся окне он увидит список удаленных элементов. Затем нужно выбрать и восстановить необходимый элемент. <br /><br /><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/8875.image_5F00_013511D2.png"><img alt="clip_image002[4]" border="0" height="177" src="http://lh6.ggpht.com/-JPS8CS5TKHY/UoS5uWI0LqI/AAAAAAAABlI/nW4VDRU5-YQ/clip_image002%25255B4%25255D%25255B3%25255D.png?imgmax=800" style="border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline;" title="clip_image002[4]" width="627" /></a> <br /><br /><b>Как восстановить элемент, срок хранения которого истек?</b><b></b> <br /><b><br /></b>Если Вам нужно восстановить удаленный элемент, срок хранения которого истек, то есть только один способ это сделать - восстановить его из последнего полного бэкапа (full backup) той базы, в которой хранился соответствующий элемент. В этом отношении процедура идентична восстановлению почтовых ящиков. <br />Вы восстанавливаете базу данных в «<b>Базу Данных Восстановления</b>» (<b>Recovery</b> <b>Database</b><b>)</b>. Затем используете следующую команду. <br />New-MailboxRestoreRequest –SourceDatabase “имя Базы Данных Восстановления (<b>Recovery</b> <b>Database</b>)” –SourceStoreMailbox “имя п/я в котором содержится пострадавшая папка” –TargetMailbox “п/я в который переносим папку” –AllowLegacyDNMismatch –IncludeFolders “имя пострадавшей папки” <br />Недостающие элементы будут восстановлены в базу данных. <br /><br /><b>ВАЖНО</b>: Убедитесь, что у Вас установлено Накопительное Обновление 2 (Cumulative Update 2) для Microsoft Exchange 2013 Server, чтобы избежать проблем с разрешениями, которые обсуждаются в этом блоге (<a href="http://blogs.technet.com/b/exchange/archive/2013/07/12/e2013-rtm-cu2-issue-public-folder-permissions-loss-after-pf-mailbox-move.aspx">Exchange 2013 RTM CU2 (712.22) Issue - Public Folder Permissions Loss after PF Mailbox Move</a>). <br /><br /><b>Использование </b><b>Outlook</b><b> для восстановления удаленных общих папок</b><b></b> <br /><b><br /></b>Клиент Outlook упрощает восстановление удаленных общих папок. Для этого необходимо следующее: <br /><ul><li>Пользователь, который проводит восстановление, должен иметь права Владелец (<b>Owner</b><b>)</b> на ту папку, которую восстанавливает. </li><li>Папка должна быть в пределах хранения удаленных элементов (retention period). </li><li>Если папка восстанавливается на корневом (root) уровне, то пользователь должен обладать правами владельца (owner) на корневом (root) уровне. </li><li>Если восстанавливаемая общая папка является дочерней (Child) папкой, то пользователь должен обладать правами владельца (owner) на родительскую (Parent) папку.</li></ul>Теперь давайте рассмотрим сценарий когда Вам нужно восстановить корневую папку. И предположим, что сначала нужно выдать соответствующие права, которые нужны для восстановления корневой папки. <br />В Exchange Admin Center (EAC) назначьте необходимые права соответствующему пользователю, который будет проводить восстановление, и нажмите "сохранить" (<b>save</b><b>)</b>. <br /><br /><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/2055.image_5F00_171E8422.png"><img alt="clip_image003[4]" border="0" height="187" src="http://lh4.ggpht.com/-8DVgYIfqa60/UoS5uzuwQCI/AAAAAAAABlQ/YM38M9D4RYY/clip_image003%25255B4%25255D%25255B3%25255D.png?imgmax=800" style="border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline;" title="clip_image003[4]" width="433" /></a> <br /><br />После того как права будут назначены, пользователь сможет восстановить общую папку используя функционал восстановления удаленных элементов (<b>Deleted</b><b> </b><b>Items</b>) в Outlook. После восстановления удалите предоставленные права. <br />На заметку: <br /><ul><li>После того как папка восстановлена через Outlook Вам нужно переименовать ее так, как она называлась раньше, до восстановления. </li><li>Любая корневая общая папка, которая восстанавливается через Outlook, будет восстановлена в<i> О</i>сновной <i>П</i>очтовый <i>Я</i>щик <i>И</i>ерархии<i> (</i><i>Primary</i><i> </i><i>Public</i><i> </i><i>Folder</i><i> </i><i>mailbox</i><i>)</i>. Если ее нужно переместить в дополнительный, то можете воспользоваться следующей командой:</li></ul>New-PublicFolderMoveRequest -Folders \&lt;имя папки&gt; -TargetMailbox "Целевой почтовый ящик" <br /><br />Дополнительная информация: <a href="http://technet.microsoft.com/en-us/library/jj878081(v=exchg.150).aspx">New-PublicFolderMoveRequest </a>(на англ. языке) <br /><br /><b>ПРИМЕЧАНИЕ ПЕРЕВОДЧИКА: </b><br />Существует два типа почтовых ящиков общих папок: <i>основной почтовый ящик иерархии</i> и <i>дополнительные почтовые ящики иерархии</i>. Оба типа почтовых ящиков могут иметь следующее содержимое. <br /><ul><li><b>Основной почтовый ящик иерархии.</b> Основной почтовый ящик иерархии представляет собой доступную для записи копию иерархии общих папок. Иерархия общих папок копируется во все другие почтовые ящики общих папок, но эти копии будут доступны только для чтения. </li><li><b>Дополнительные почтовые ящики иерархии. </b>Дополнительные почтовые ящики иерархии вмещают содержимое общих папок, а также доступную только для чтения копию иерархии общих папок.</li></ul>Если корневая папка также содержит дочерние папки, которые были восстановлены, Вам может понадобится переместить их в дополнительный почтовый ящик. Перемещение корневой общей папки в другой почтовый ящик не меняет содержимое соответствующих дочерних папок. Для того, чтобы переместить общую папку в нужный почтовый ящик используйте скрипт .\Move-PublicFolderBranch.PS1 <br />На заметку:  <br /><ul><li>Возможно проще будет использовать <b>Exchange</b><b> </b><b>Management</b><b> </b><b>Shell</b>. Особенно это предпочтительно в сценариях, когда Вам нужно восстановить удаленные дочерние общие папки или удалить родительскую общую папку, которая также имеет дочерние папки (см. ниже) </li></ul>Любой корневой общей папке, которая была удалена и восстановлена с помощью Outlook, клиент должен присвоить ее оригинальные разрешение. Если в корневой общей папке также были восстановлены дочерние общие папки, то разрешения для дочерних папок будут заменены. Они наследуются от родительского объекта. <br /><br />Читайте продолжение:<br /><a href="http://www.danshin.ms/2013/11/exchange-2013-2.html" style="text-align: right;">Восстановление информации в общих папках Exchange 2013 - часть 2</a><br /><br />Автор статьи: Siddhesh Dalvi.<br /><br />Оригинал статьи на англ. языке находится по следующей ссылке: -&nbsp;<a href="http://blogs.technet.com/b/exchange/archive/2013/08/23/recovering-public-folder-information-in-exchange-2013.aspx">http://blogs.technet.com/b/exchange/archive/2013/08/23/recovering-public-folder-information-in-exchange-2013.aspx</a><br /><br />Переводчик:<br />Даньшин Михаил Сергеевич<br />Блог –&nbsp;<a href="http://danshin.ms/">http://danshin.ms</a><br />Facebook -&nbsp;<a href="https://www.facebook.com/Danshin.ms">https://www.facebook.com/Danshin.ms</a><br />E-Mail: -&nbsp;<a href="mailto:mdanshin@gmail.com">mdanshin@gmail.com</a><br /><br /> <iframe src="//www.facebook.com/plugins/follow?href=https%3A%2F%2Fwww.facebook.com%2Fmdanshin&amp;layout=standard&amp;show_faces=true&amp;colorscheme=light&amp;width=450&amp;height=80" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:450px; height:80px;" allowTransparency="true"></iframe>