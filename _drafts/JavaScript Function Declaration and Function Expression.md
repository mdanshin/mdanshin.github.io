---
layout: post
title:  "JavaScript - переменные"
categories: [ Программирование ]
tags: [ JavaScript ]
image: assets/images/JavaScript-variables/0.jpg
author: Mikhail
---
***Тема переменных в JavaScipt неожиданно оказалась совсем не простой. Решли законспектировать те знания, что удалось получить.***

### Объявление переменных

[Официальная документация](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Grammar_and_types#Declarations) гласит - есть три способа объявить переменные в JavaScript:

**var**
Этот синтаксис может использоваться для объявления как локальных, так и глобальных переменных, в зависимости от контекста выполнения.

**let**, **const**
Этот синтаксис может использоваться для объявления локальной переменной области блока (block-scoped). При этом `constant` - это переменная только для чтения.

```
Начиная с ECMAScript2015, объявления переменных let и const имеют ограниченную область видимости. JavaScript до ECMAScript2015 (ES6, 6-е издание) не имеет блока видимости!
```

>Вы также можете просто присвоить значение переменной. Например, `x = 42`. Эта форма создает необъявленную (Undeclared) глобальную переменную. Также это генерирует строгое предупреждение JavaScript. Необъявленные глобальные переменные часто могут привести к неожиданному поведению. Таким образом, не рекомендуется использовать необъявленные глобальные переменные.

Вроде всё просто. Мы имеем глобальну, локальную переменную и константу.


||var|let|const|
|--------|:-:|---|----:|
|переназначение|O|O|X|
|Scope|Function Scope|Block Scope|Block Scope|
|Ссылка до объявления|O|X|X|

Например, следующий код выведет в консоль `5`, т.к. используется глобальная переменная.

```javascript
if (true) {
  var x = 5;
}
console.log(x);  // x is 5
```

А в примере ниже мы получим ошибку, т.к. переменная `y` локальная. Она обявлена через let, а значит доступная только в блоке кода, ограниченный парой фигурных скобок.

```javascript
if (true) {
  let y = 5;
}
console.log(y);  // ReferenceError: y не определена
```

Глобальная переменная - это переменная объявленная за пределами функции и доступная во всех функциях.

Локальная переменная - это переменная объявленная внутри функции или другого блока кода и доступная только в этом блоке кода. И тут нужно погознакомиться с областью видимости.

### Область видимости

Есть такое понятие как Scope. В русском переводе это часто называют `область видимости` или `область действия`. Существует несколько скопов.

* Global Scope
* Local Scope
* Function Scope
* Block Scope
* Lexical Scope

Что будет, если выполнить следующий код?

```javascript
function run() {
  var foo = "Foo";
  let bar = "Bar";
}

console.log(foo, bar);
run()
```

В результате выполнения мы получим `ReferenceError: foo is not defined`. Почему так происходит? Всё дело в области видимости.

Когда мы обращаемся к переменной `foo` за пределами функции, мы не можем получить её значение, потому, что она объявлена в области Function Scope. Тоже самое относится и к переменной `bar`. 

---

>Всё, что находится в `block-scoped` доступно только из `block-scoped` или дочерних `block-scoped`.

Немного переделаем наш пример и вынесем объявление переменных за пределы функции `run()`.

```javascript
var foo = "Foo";
let bar = "Bar";

function run() {
  console.log(foo, bar);
}

console.log(foo, bar);

run()
```

В этом случае программа выполнится корректно и мы получим в консоле два раза вывод этих переменных.

![JavaScript-variables/1.png](/assets/images/JavaScript-variables/1.png)

Возникает вопрос - в чём же разница между `var` и `let`? За пределами `block-scoped` не будет видна ниодна из этих переменных. А объявляя их за пределами `block-scoped` мы получаем доступ к обоим. Зачем тогда нужен `let`? Почему всегда не использовать тольок `var` и не вносить путаницу?

В официальной документации я не нашёл ответ. [Лучший ответ]((https://stackoverflow.com/questions/762011/whats-the-difference-between-using-let-and-var?page=1&tab=votes#tab-top)) на этот вопрос я обнаружил на stackoverflow.com.

Парадокс, но ответ сводится к тому, что `let` ввели для того, чтобы путаницы было меньше.

>The reason why let keyword was introduced to the language was function scope is confusing and was one of the main sources of bugs in JavaScript.

Взглянем на следующий пример

```javascript
var funcs = [];

// создадим 3 функции
for (var i = 0; i < 3; i++) {
  // и сохраним их в funcs
  funcs[i] = function() {
    // каждая должна выводить значение
    console.log("My value: " + i);
  };
}

for (var j = 0; j < 3; j++) {
  // и теперь запустим каждую
  funcs[j]();
}
```

В результате выполнения мы получим мы ожидаем увидеть вывод трёх значений, от 1 до 3.