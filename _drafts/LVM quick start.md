---
layout: post
title:  "LVM - коротко о главном"
categories: [ Администрирование ]
tags: [ Linux ]
image: assets/images/LVM-quick-start/0.jpg
author: Mikhail
---
***В этой статье дано краткое описание того, что такое LVM и рассмотрены основные приёмы работы на практическом примере. Из этой статьи вы узнаете о том, как создавать тома LVM и как с ними работать. По ходу статьи мы в ручную, с нуля, разметим диск виртуальной машины для установки операционной системы CentOS 8. Затем добавим ещё один диск и расширим уже имеющиеся тома.***

### Что такое LVM

LVM - это менеджер логических томов (англ. logical volume manager) — подсистема, позволяющая использовать разные области одного или нескольких жёстких дисков как один логический том. Работа LVM основана на Device Mapper - это подсистеме ядра Linux, которая позволяет создавать виртуальные блочные устройства. В совокупности всё это позволяет нам абстрагироватся от физичиских устройств и устаревших разделов жестких дисков и создать удобную логическую структуру томов, а так же:

* объединять их в группы
* изменять размер
* перемещать данные
* делать снапшоты
* зеркалировать
* шифоровать

... и многое другое. И всё это не останавливая работу системы.

Наиболее полная статья по LVM, которая мне попадалась в рунете, находится на [xgu.ru](http://xgu.ru/wiki/LVM). Рекомендую с ней ознакомиться, после прочтения моего краткого введения.

Чтобы проиллюстрировать работу LVM приведу одну простую картинку.

![LVM-quick-start/1.png](/assets/images/LVM-quick-start/1.png)

Ничего, если она покажется вам непонятной. После прочтения статьи вам станет всё понятно.

>Я исхожу из того, что вам уже приходилось размечать жёсткий диск на партиции, например утилитой fdisk, и у вас есть понимание что это такое и для чего это нужно. И у вас есть понимание, что такое точка монтирования, загрузочный раздел и т.п..

Во время установки ОС, разметку жосткого диска можно полность отдать на откуп системы. Она сама сделает нужную конфигурацию на жёстком диски, создаст необходимые тома и точки монтирования. Но в целях обучения, мы сделаем это всё сами, на пустом жёстком диски. Для примера я буду использовать виртуальную машину под управлением VMware Workstation Player и операционную систему CentOS 8. Но всё тоже самое можно сделать из любого популярного дистрибутива Linux, используя любую систему виртуализации или на физическом оборудовании.

Создайте виртуальную машину или используйте не размеченный жесткий диск на компьютере. Загрузитесь с установочного диска (ISO-образа) и вызовите командную строку. Обычно, и в часиности в CentOS, это делается комбинацией клавишь `Ctrl+Alt+F2`.

>ВНИМЕНИЕ. ДАЛЬНЕЙШИЕ ВЫПОЛНЕНИЕ ДАЛЬНЕЙШИХ ИНСТРУКЦИЙ БУДЕТ ДЕСТРУКТИВНО ДЛЯ ДАННЫХ. ДЕЙСТВУЙТЕ С УМОМ!

Следующими командами можно увидеть какие блочные устройства доступны системе.

```bash
ls -l /dev/sd*
```

и

```bash
ls -l /dev/disk/by-id/
```

вывод этих команд показан на снимке и может отличаться в вашем случае

![LVM-quick-start/2.png](/assets/images/LVM-quick-start/2.png)

Далее, для создания структуры LVM, мы будем использовать утилиту `parted`. Запустите её следующеё командой:

```bash
parted /dev/sda
```

После запуска нажмите `p`, чтобы увидеть данные об устройстве и введите команду `help mklabel`, чтобы увидеть, какие метки тома мы можем создать. Вывод показан на снимке.

![LVM-quick-start/3.png](/assets/images/LVM-quick-start/3.png)

Мы видим, что мы имеем дело с виртуальным жёстким диском VMware (`Model: VMware, VMware Virtual S (scsi)`), не имеющего метку (`Error: /dev/sda: unrecognised disk label`) и таблиц разделов (`Partition Table: unknown`). Размер диска составляет 21.5GB.

>**СПРАВКА:** *Таблица разделов представляет собой 64-байтовую структуру данных, которая предоставляет базовую информацию для операционной системы компьютера о разделении жесткого диска (HDD) на основные разделы.*

Первое, что нам нужно сделать - это создасть `partition table`. Для этого используем соответствующую команду:

```bash
mklable msdos
```
И с помощью команды `p` смотрим, что получилось.

![LVM-quick-start/4.png](/assets/images/LVM-quick-start/4.png)

Мы можем наблюдать, что ушла ошибка `Error: /dev/sda: unrecognised disk label` и таблица разделов имеет тип `msdos`. Таким образом мы подготовили жёсткий диск - создали таблицу разделов, но пока не создавали сами разделы. Выходим из программы `parted` набрав `quit` или просто `q`.

Теперь всё готово для создании структуры LVM. Для этого мы должны создать физический том, создать виртуальную группу и в ней создать виртуальные тома. Читайте дальше и всё сейчас поймёте.

### Физический том (Physical volume, PV)
Физический том - это раздел диска или весь диск. Создать физический том - означает пометить раздел (или диск) как использумый для структуры LVM. 

Как говорится в инструкции:
```
`pvcreate` initializes PhysicalVolume for later use by the Logical Volume Manager (LVM).
```

В нашем случае у нас всего одно устройство `/dev/sda` и мы его пометим как устройство LVM - тоесть создадим из него физический том LVM.

>Да, я тоже `физическим` привык называть жёсткий диск. Но правильно его назывть `Storage Device`.

Выполняем команду для создания physical volume, указывая какой диск мы помечаем как устройство LVM:

```bash
pvcreate /dev/sda
```

![LVM-quick-start/5.png](/assets/images/LVM-quick-start/5.png)

И тут мы встречаемся с первой сложностью, которую тут же и приодолеваем. Дело в том, что ранее мы пометили наш раздел как msdos.
