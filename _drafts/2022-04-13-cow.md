---
layout: post
title:  "Механизм копирования при записи (англ. Copy-On-Write, COW)"
categories: [ Системное администрирование ]
tags: [ CoW, Linux ]
image: assets/images/linux-filesystem-operations/0.jpg
author: Mikhail
---
***Познакомился с очень крутой концепцией Copy-On-Write. Идея подхода copy-on-write заключается в том, что при чтении области данных используется общая копия, в случае изменения данных — создается новая копия. И вот, что я узнал.***

Допустим есть переменная A, которая ссылается на ячейку в памяти. Мы создаём переменные B и C и выполняем операцию присвоения.

```javascript
let A = 'data'
let B
let C

B = A
C = A
```

При подходе CoW данные не копируются, а просто переменные B и C начинают ссылаться на ту же ячейку памяти. Пока кто-то не захочет их мутировать. 

![assets/images/CoW/1.png](/assets/images/CoW/1.png)

А когда мы захотим мутировать данные, например через переменную C, то тогда произойдёт копирование данных в новую область памяти, данные изменятся там, а переменная C будет ссылаться на новую область.

![assets/images/CoW/2.png](/assets/images/CoW/2.png)

Тот же самый подход можно использовать в Linux, например, для создания копий файлов. Здесь можно провести аналогию с переменными - имя файла - это переменная, содержимое файла - это область памяти (диска), содержащая значение переменной (данные). 

У такого подхода есть преимущества и недостатки.

### Преимущества

1. Если данные не будут мутированы, то данные нам достаются бесплатно (не занимают дополнительного места на диске).
2. Скорость копирования

### Недостатки
